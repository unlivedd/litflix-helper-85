
# BOOKS - Книжная рекомендательная система | Руководство пользователя

## Общая информация о проекте

BOOKS - это веб-приложение для любителей книг и фильмов, которое позволяет:
- Искать и просматривать книги
- Добавлять книги и фильмы в избранное 
- Получать рекомендации фильмов на основе выбранных книг и наоборот
- Регистрироваться и входить в систему для сохранения предпочтений

## Содержание

1. [Установка и запуск](#установка-и-запуск)
2. [Функциональные возможности](#функциональные-возможности)
3. [Описание страниц](#описание-страниц)
4. [Технические детали](#технические-детали)
5. [Как это работает](#как-это-работает)

## Установка и запуск

### Требования

- Node.js (v14.0 или выше)
- npm (v6.0 или выше) или yarn

### Шаги по установке

1. Клонируйте репозиторий
```bash
git clone <url-репозитория>
cd books-app
```

2. Установите зависимости
```bash
npm install
# или
yarn install
```

3. Запустите проект в режиме разработки
```bash
npm run dev
# или
yarn dev
```

4. Откройте браузер и перейдите по адресу: `http://localhost:5173`

### Сборка для продакшена

```bash
npm run build
# или
yarn build
```

После сборки вы можете запустить приложение с помощью:
```bash
npm run preview
# или
yarn preview
```

## Функциональные возможности

### 1. Система пользователей

- **Регистрация**: Создание нового аккаунта с именем, email и паролем
- **Вход в систему**: Авторизация с использованием существующего аккаунта
- **Хранение данных**: Сохранение информации о пользователе, включая избранное
- **Выход из системы**: Завершение сеанса и очистка пользовательских данных

### 2. Управление книгами

- **Просмотр книг**: Отображение списка доступных книг
- **Поиск книг**: Поиск по названию, автору, жанру
- **Детали книги**: Подробная информация о выбранной книге
- **Рейтинги книг**: Отображение рейтинга книг
- **Выбор книг для рекомендаций**: Отметка книг для получения рекомендаций по фильмам

### 3. Управление фильмами

- **Просмотр фильмов**: Отображение списка доступных фильмов
- **Детали фильма**: Информация о режиссере, годе выпуска, жанре
- **Рейтинги фильмов**: Отображение рейтинга фильмов
- **Выбор фильмов для рекомендаций**: Отметка фильмов для получения рекомендаций по книгам

### 4. Избранное

- **Добавление в избранное**: Сохранение книг и фильмов в список избранного
- **Удаление из избранного**: Возможность убрать элементы из списка
- **Просмотр избранного**: Страница с сохраненными книгами и фильмами
- **Быстрый доступ**: Переход к деталям избранного элемента

### 5. Система рекомендаций

- **На основе книг**: Получение рекомендаций фильмов на основе выбранных книг
- **На основе фильмов**: Получение рекомендаций книг на основе выбранных фильмов
- **Персонализированные рекомендации**: Рекомендации с учетом предпочтений пользователя
- **Сохранение выбора**: Возможность вернуться к предыдущему выбору

## Описание страниц

### Главная страница (Index)

- Обзор популярных книг
- Кнопки для перехода к книгам и фильмам
- Кнопка для получения рекомендаций (если пользователь авторизован)
- Блок с топ-рейтинговыми книгами

### Книги (Books)

- Список доступных книг с возможностью фильтрации
- Добавление книг в избранное
- Выбор книг для получения рекомендаций
- Детальная информация о книге при клике

### Детали книги (BookDetail)

- Подробная информация о выбранной книге
- Возможность добавить в избранное
- Рейтинг книги
- Похожие книги

### Фильмы (Movies)

- Список доступных фильмов
- Добавление фильмов в избранное
- Выбор фильмов для получения рекомендаций книг
- Информация о режиссере, годе выпуска, жанре

### Избранное (Favorites)

- Список сохраненных книг и фильмов
- Возможность удаления из избранного
- Быстрый переход к деталям элемента

### Рекомендации (Recommendations)

- Персонализированные рекомендации на основе выбранных элементов
- Возможность добавить рекомендованные элементы в избранное
- Переключение между рекомендациями книг и фильмов

### Вход в систему (Login) и Регистрация (Register)

- Формы для авторизации и создания нового аккаунта
- Валидация введенных данных
- Обработка ошибок и сообщения об успешной операции

### Анкета (Questionnaire)

- Сбор информации о предпочтениях пользователя
- Вопросы о любимых жанрах, авторах, фильмах
- Использование данных для улучшения рекомендаций

## Технические детали

### Архитектура приложения

Приложение построено с использованием следующей архитектуры:

1. **Фронтенд**: React + TypeScript
   - React Router для навигации
   - Tailwind CSS для стилизации
   - Lucide для иконок
   - Sonner для уведомлений

2. **Имитация бэкенда**:
   - Локальное хранилище (localStorage) для данных пользователя
   - Эмуляция MongoDB через mongoService.ts
   - Хранение данных о книгах, фильмах и пользователях

3. **Управление состоянием**:
   - React hooks (useState, useEffect)
   - Пользовательские хуки для логики авторизации и работы с данными

### Основные компоненты и файлы

#### Компоненты UI
- **Header.tsx**: Навигационное меню и поиск
- **BookCard.tsx**: Карточка книги
- **BackButton.tsx**: Кнопка возврата
- **UserMenu.tsx**: Пользовательское меню
- **SearchBar.tsx**: Компонент поиска
- **TopRatedBooks.tsx**: Блок с топовыми книгами

#### Сервисы
- **authService.ts**: Авторизация пользователей
- **bookService.ts**: Работа с книгами
- **favoritesService.ts**: Управление избранным
- **mongoService.ts**: Эмуляция MongoDB

#### Страницы
- **Index.tsx**: Главная страница
- **Books.tsx**: Список книг
- **BookDetail.tsx**: Детали книги
- **Movies.tsx**: Список фильмов
- **Favorites.tsx**: Избранное
- **Recommendations.tsx**: Рекомендации
- **Login.tsx** и **Register.tsx**: Авторизация
- **Questionnaire.tsx**: Анкета
- **NotFound.tsx**: Страница 404

### Навигация

Приложение использует react-router-dom для маршрутизации между страницами. Основные маршруты:

- `/` - Главная страница
- `/books` - Страница книг
- `/book/:id` - Детали книги
- `/movies` - Страница фильмов
- `/favorites` - Избранное
- `/recommendations` - Рекомендации
- `/login` и `/register` - Авторизация
- `/questionnaire` - Анкета

## Как это работает

### Система пользователей

#### Регистрация и вход
1. **Процесс регистрации**:
   - Пользователь заполняет форму с именем, email и паролем
   - Данные проверяются на существование пользователя с таким email
   - Если пользователь не существует, создается новая запись в "базе данных" (localStorage)
   - После регистрации пользователь автоматически авторизуется

2. **Процесс входа**:
   - Пользователь вводит email и пароль
   - Система проверяет данные в "базе данных"
   - При совпадении данные пользователя сохраняются в localStorage
   - Интерфейс обновляется, показывая авторизованное состояние

3. **Хранение данных пользователя**:
   - Данные хранятся в localStorage с ключом 'currentUser'
   - Информация включает имя, email, список избранного
   - При выходе данные удаляются из localStorage

#### Код авторизации
```javascript
// Регистрация
export const registerUser = async (userData: { name: string; email: string; password: string }): Promise<boolean> => {
  // Проверка существования пользователя
  const existingUser = usersCollection.findOne({ email: userData.email });
  if (existingUser) {
    // Показ ошибки если пользователь существует
    return false;
  }
  
  // Создание нового пользователя
  const newUser: User = {
    ...userData,
    favorites: []
  };
  
  // Сохранение в базе данных
  usersCollection.insertOne(newUser);
  
  // Автоматический вход
  localStorage.setItem('currentUser', JSON.stringify(newUser));
  return true;
};

// Вход
export const loginUser = async (email: string, password: string): Promise<boolean> => {
  // Поиск пользователя
  const user = usersCollection.findOne({ email, password });
  
  if (user) {
    // Сохранение в localStorage
    localStorage.setItem('currentUser', JSON.stringify(user));
    return true;
  }
  return false;
};
```

### Система избранного

#### Механизм работы избранного

1. **Добавление в избранное**:
   - При нажатии на кнопку "сердечко" вызывается функция `toggleFavorite`
   - Проверяется, авторизован ли пользователь
   - Если элемент уже в избранном - он удаляется, если нет - добавляется
   - Обновляются данные пользователя в localStorage и "базе данных"
   - Отображается уведомление (toast) о добавлении/удалении

2. **Проверка статуса**:
   - Функция `isInFavorites` проверяет, находится ли элемент в избранном
   - Для этого сравнивается id и тип элемента с данными из списка избранного пользователя
   - Результат используется для отображения заполненного/пустого сердечка

3. **Получение списка избранного**:
   - Функция `getFavorites` возвращает весь список избранных элементов пользователя
   - При отображении страницы избранного элементы фильтруются по типу

#### Код работы с избранным
```javascript
export const toggleFavorite = (item: FavoriteItem): boolean => {
  // Проверка авторизации
  const currentUser = getCurrentUser();
  if (!currentUser) {
    toast.error('Необходимо войти для добавления в избранное');
    return false;
  }
  
  // Инициализация массива избранного
  if (!currentUser.favorites) {
    currentUser.favorites = [];
  }
  
  // Поиск элемента в избранном
  const existingIndex = currentUser.favorites.findIndex(
    (fav) => fav.id === item.id && fav.type === item.type
  );
  
  let isNowFavorite = false;
  
  // Добавление или удаление
  if (existingIndex !== -1) {
    currentUser.favorites.splice(existingIndex, 1); // Удаление
    toast.success(`"${item.title}" удалено из избранного`);
  } else {
    currentUser.favorites.push(item); // Добавление
    isNowFavorite = true;
    toast.success(`"${item.title}" добавлено в избранное`);
  }
  
  // Обновление данных пользователя
  updateUser({ favorites: currentUser.favorites });
  
  // Событие для обновления UI
  window.dispatchEvent(new CustomEvent('favorites-changed'));
  
  return isNowFavorite;
};
```

### Система поиска и фильтрации

#### Как работает поиск

1. **Компонент SearchBar**:
   - Содержит поле ввода для поискового запроса
   - При вводе текста вызывается функция `handleSearch`
   - Запрос передается в родительский компонент через пропс `onSearch`

2. **Фильтрация книг**:
   - В `bookService.ts` реализована функция `searchBooks`, которая фильтрует книги
   - Поиск происходит по заголовку, автору и жанру книги
   - Функция возвращает массив книг, соответствующих запросу

3. **Отображение результатов**:
   - Результаты поиска отображаются в режиме реального времени
   - Компонент Books обновляет состояние и перерисовывает список книг

#### Код поиска
```javascript
// В компоненте SearchBar
const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {
  const query = e.target.value;
  setSearchQuery(query);
  onSearch(query); // Вызов функции-обработчика из родительского компонента
};

// В сервисе книг
export const searchBooks = (query: string): Book[] => {
  const lowerCaseQuery = query.toLowerCase();
  return sampleBooks.filter(book => 
    book.title.toLowerCase().includes(lowerCaseQuery) ||
    book.author.toLowerCase().includes(lowerCaseQuery) ||
    (book.genre && book.genre.toLowerCase().includes(lowerCaseQuery))
  );
};
```

### Система рекомендаций

#### Как работают рекомендации

1. **Выбор элементов для рекомендаций**:
   - Пользователь выбирает книги или фильмы на соответствующих страницах
   - Выбранные элементы отмечаются и сохраняются в состоянии приложения
   - После выбора элементов пользователь переходит на страницу рекомендаций

2. **Алгоритм рекомендаций**:
   - Система анализирует жанры, авторов и рейтинг выбранных элементов
   - Для каждого выбранного элемента подбираются похожие элементы другого типа
   - Учитываются предпочтения пользователя, если он проходил анкету
   - Результаты сортируются по релевантности

3. **Отображение рекомендаций**:
   - Рекомендации отображаются в виде карточек
   - Пользователь может добавить рекомендованные элементы в избранное
   - Предоставляется возможность перехода к детальной информации

#### Пример алгоритма рекомендаций
```javascript
// Упрощенный пример алгоритма рекомендаций
const getRecommendations = (selectedItems, targetType) => {
  // Получаем жанры и авторов выбранных элементов
  const genres = selectedItems.map(item => item.genre);
  const authors = selectedItems.map(item => item.author);
  
  // Получаем все элементы целевого типа
  const allTargetItems = targetType === 'movie' ? allMovies : allBooks;
  
  // Фильтруем элементы по совпадению жанров и авторов
  const recommendations = allTargetItems.filter(item => {
    // Проверяем совпадение жанра
    const genreMatch = genres.includes(item.genre);
    
    // Для книг проверяем автора
    const authorMatch = targetType === 'book' ? 
      authors.includes(item.author) : 
      false;
    
    return genreMatch || authorMatch;
  });
  
  // Сортируем по рейтингу
  return recommendations.sort((a, b) => b.rating - a.rating);
};
```

### Эмуляция базы данных

#### Как работает mongoService

1. **Инициализация базы данных**:
   - При первом запуске приложения вызывается функция `initializeDatabase`
   - Создаются коллекции в localStorage с префиксом 'mongodb_'
   - Добавляется тестовый пользователь для удобства

2. **Коллекции и документы**:
   - База данных содержит коллекции 'users', 'books', 'movies'
   - Каждая коллекция хранится в localStorage как JSON-строка
   - Документы имеют уникальные идентификаторы (_id)

3. **Методы работы с базой данных**:
   - `find()` - поиск документов, соответствующих запросу
   - `findOne()` - поиск одного документа
   - `insertOne()` - добавление документа
   - `updateOne()` - обновление документа
   - `deleteOne()` - удаление документа

4. **Пример работы с базой данных**:
```javascript
// Получение коллекции пользователей
const usersCollection = getDatabase().collection('users');

// Поиск пользователя по email
const user = usersCollection.findOne({ email: 'test@example.com' });

// Обновление данных пользователя
usersCollection.updateOne(
  { _id: user._id },
  { $set: { favorites: [...user.favorites, newFavorite] }}
);

// Подобно MongoDB API, но работает с localStorage
```

### Интеграция компонентов

#### Как компоненты взаимодействуют друг с другом

1. **Header и другие компоненты**:
   - Header отображается на всех страницах
   - Содержит UserMenu для управления аутентификацией
   - Включает SearchBar на страницах с поиском

2. **Передача данных между компонентами**:
   - Props для передачи данных от родителя к дочернему компоненту
   - События и коллбэки для передачи данных от дочернего к родительскому
   - Глобальные события (window.dispatchEvent) для оповещения о изменениях избранного

3. **Переиспользование компонентов**:
   - BookCard используется на страницах Books, Favorites, Recommendations
   - SearchBar используется на страницах Books и Movies
   - BackButton используется на всех вложенных страницах

#### Пример интеграции компонентов
```javascript
// В родительском компоненте Books
const Books = () => {
  const [searchResults, setSearchResults] = useState<Book[]>([]);
  
  const handleSearch = (query: string) => {
    const results = searchBooks(query);
    setSearchResults(results);
  };
  
  return (
    <div>
      <Header />
      <SearchBar onSearch={handleSearch} />
      <div className="book-list">
        {searchResults.map(book => (
          <BookCard 
            key={book.id} 
            book={book}
            onFavoriteToggle={handleFavoriteToggle} 
          />
        ))}
      </div>
    </div>
  );
};

// В дочернем компоненте BookCard
const BookCard = ({ book, onFavoriteToggle }) => {
  const handleFavoriteClick = () => {
    const result = toggleFavorite({
      id: book.id,
      type: 'book',
      title: book.title,
      subtitle: book.author
    });
    onFavoriteToggle(book.id, result);
  };

  return (
    <div className="book-card">
      <h3>{book.title}</h3>
      <p>{book.author}</p>
      <button onClick={handleFavoriteClick}>
        {isInFavorites(book.id, 'book') ? '❤️' : '🤍'}
      </button>
    </div>
  );
};
```

### Маршрутизация и навигация

#### Подробности реализации маршрутизации

1. **React Router**:
   - Используется `react-router-dom` для маршрутизации
   - Маршруты определены в файле `App.tsx`
   - Для навигации используются компоненты `Link` и `Navigate`

2. **Параметры URL**:
   - Для страницы книги используется параметр `:id` (например, `/book/1`)
   - Параметры извлекаются с помощью хука `useParams()`
   - Данные загружаются на основе параметров

3. **Обработка истории навигации**:
   - Хук `useNavigate()` для программной навигации
   - Хук `useLocation()` для доступа к текущему местоположению
   - Сохранение состояния при навигации (например, предыдущая страница)

4. **BackButton для возврата**:
   - Компонент использует `window.history.back()` для возврата
   - На главной странице кнопка скрывается
   - При навигации с главной страницы возврат происходит обратно на главную

#### Пример реализации маршрутизации
```javascript
// В App.tsx
const App = () => {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Index />} />
        <Route path="/books" element={<Books />} />
        <Route path="/book/:id" element={<BookDetail />} />
        <Route path="/favorites" element={<Favorites />} />
        <Route path="/login" element={<Login />} />
        <Route path="/register" element={<Register />} />
        <Route path="*" element={<NotFound />} />
      </Routes>
    </BrowserRouter>
  );
};

// В компоненте страницы
const BookDetail = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const location = useLocation();
  const [book, setBook] = useState<Book | null>(null);
  
  useEffect(() => {
    const bookId = parseInt(id || '0');
    const bookData = getBookById(bookId);
    
    if (bookData) {
      setBook(bookData);
    } else {
      navigate('/books', { replace: true });
    }
  }, [id, navigate]);

  return (
    <div>
      <BackButton />
      {book && (
        <div>
          <h1>{book.title}</h1>
          <p>{book.author}</p>
          {/* Остальные детали книги */}
        </div>
      )}
    </div>
  );
};
```

## Дополнительная информация

### Хранение данных

Приложение использует localStorage для хранения данных между сессиями. Это включает:
- Данные пользователя: `localStorage.getItem('currentUser')`
- Эмуляция MongoDB: `localStorage.getItem('mongodb_users')` и др.
- История навигации: `sessionStorage.getItem('navigation_history')`

### Персонализация

Система рекомендаций учитывает:
- Выбранные пользователем книги и фильмы
- Жанровые предпочтения
- Историю взаимодействия с приложением

### Возможности дальнейшего развития

1. Интеграция с реальным API для книг и фильмов
2. Добавление рецензий и комментариев
3. Социальные функции (делиться списками, рекомендациями)
4. Улучшенный алгоритм рекомендаций на основе машинного обучения
5. Мобильное приложение

---

Спасибо за использование нашего приложения BOOKS! Если у вас есть вопросы или предложения, пожалуйста, свяжитесь с нами.
